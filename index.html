<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chakipur Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link href="styles.css" rel="stylesheet" />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#f97316",
              secondary: "#3b82f6",
            },
          },
        },
      };
    </script>
  </head>
  <body
    class="bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-300"
  >
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg sticky top-0 z-40">
      <div class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <i class="fas fa-tachometer-alt text-2xl"></i>
            <h1 class="text-2xl font-bold" data-translate="header.title">
              Chakipur Dashboard
            </h1>
          </div>

          <!-- Navigation -->
          <nav class="hidden md:flex items-center space-x-6">
            <a
              href="#overview"
              class="nav-link hover:text-orange-200 transition-colors"
              data-translate="nav.overview"
              >Resumen</a
            >
            <a
              href="#incidents"
              class="nav-link hover:text-orange-200 transition-colors"
              data-translate="nav.incidents"
              >Incidentes</a
            >
            <a
              href="#trends"
              class="nav-link hover:text-orange-200 transition-colors"
              data-translate="nav.trends"
              >Tendencias</a
            >
            <a
              href="#kpis"
              class="nav-link hover:text-orange-200 transition-colors"
              data-translate="nav.kpis"
              >KPIs</a
            >
          </nav>

          <!-- User Menu -->
          <div class="flex items-center space-x-4">
            <!-- Language Selector -->
            <select
              id="languageSelector"
              class="bg-white/20 text-white border-none rounded-lg px-3 py-1 text-sm focus:ring-2 focus:ring-white/50"
            >
              <option value="es">🇪🇸 ES</option>
              <option value="qu">🏔️ QU</option>
              <option value="en">🇺🇸 EN</option>
            </select>

            <!-- Theme Toggle -->
            <button
              id="themeToggle"
              class="p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors"
            >
              <i class="fas fa-moon dark:hidden"></i>
              <i class="fas fa-sun hidden dark:inline"></i>
            </button>

            <!-- User Profile -->
            <div class="relative">
              <button
                id="userMenuBtn"
                class="flex items-center space-x-2 bg-white/20 rounded-lg px-3 py-2 hover:bg-white/30 transition-colors"
              >
                <img
                  id="userAvatar"
                  src=""
                  alt="User"
                  class="w-6 h-6 rounded-full"
                />
                <span id="userName" class="text-sm"></span>
                <i class="fas fa-chevron-down text-xs"></i>
              </button>

              <!-- Dropdown Menu -->
              <div
                id="userDropdown"
                class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg py-2 hidden"
              >
                <a
                  href="#"
                  class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
                  data-translate="header.profile"
                  >Perfil</a
                >
                <a
                  href="#"
                  class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"
                  data-translate="header.settings"
                  >Configuración</a
                >
                <hr class="my-2" />
                <button
                  id="logoutBtn"
                  class="block w-full text-left px-4 py-2 text-red-600 hover:bg-gray-100 dark:hover:bg-gray-700"
                  data-translate="header.logout"
                >
                  Cerrar Sesión
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Action Bar -->
    <div
      class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"
    >
      <div class="container mx-auto px-6 py-4">
        <div class="flex flex-wrap items-center justify-between gap-4">
          <div class="flex items-center space-x-4">
            <button id="insightsBtn" class="btn-primary">
              <i class="fas fa-lightbulb mr-2"></i>
              <span data-translate="btn.insights">Ver Insights</span>
            </button>
            <button id="recommendationsBtn" class="btn-secondary">
              <i class="fas fa-magic mr-2"></i>
              <span data-translate="btn.recommendations">Recomendaciones</span>
            </button>
          </div>

          <div class="flex items-center space-x-4">
            <button id="refreshBtn" class="btn-outline">
              <i class="fas fa-sync-alt mr-2"></i>
              <span data-translate="btn.refresh">Actualizar</span>
            </button>
            <button id="exportBtn" class="btn-outline">
              <i class="fas fa-download mr-2"></i>
              <span data-translate="btn.export">Exportar</span>
            </button>
            <button id="helpBtn" class="btn-outline">
              <i class="fas fa-question-circle mr-2"></i>
              <span data-translate="btn.help">Ayuda</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
      <!-- Resumen General -->
      <section id="overview" class="mb-8">
        <div class="flex items-center justify-between mb-6">
          <h2
            class="text-2xl font-semibold text-gray-800 dark:text-white"
            data-translate="section.overview"
          >
            Resumen General
          </h2>
          <div
            class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400"
          >
            <i class="fas fa-clock"></i>
            <span id="currentDateTime"></span>
          </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div
            class="metric-card bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow hover:shadow-lg transition-all duration-300"
          >
            <div class="flex items-center justify-between">
              <div>
                <p
                  class="text-sm font-medium text-gray-600 dark:text-gray-400"
                  data-translate="summary.responseTime"
                >
                  Tiempo de Respuesta
                </p>
                <p class="text-3xl font-bold text-orange-500" id="responseTime">
                  2.3s
                </p>
                <div class="flex items-center mt-2">
                  <i class="fas fa-arrow-down text-green-500 text-xs mr-1"></i>
                  <span class="text-xs text-green-500">-0.2s desde ayer</span>
                </div>
              </div>
              <div class="bg-orange-100 dark:bg-orange-900/30 p-3 rounded-full">
                <i class="fas fa-clock text-orange-500 text-xl"></i>
              </div>
            </div>
          </div>

          <div
            class="metric-card bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow hover:shadow-lg transition-all duration-300"
          >
            <div class="flex items-center justify-between">
              <div>
                <p
                  class="text-sm font-medium text-gray-600 dark:text-gray-400"
                  data-translate="summary.successRate"
                >
                  Tasa de Éxito
                </p>
                <p class="text-3xl font-bold text-blue-500" id="successRate">
                  94.2%
                </p>
                <div class="flex items-center mt-2">
                  <i class="fas fa-arrow-up text-green-500 text-xs mr-1"></i>
                  <span class="text-xs text-green-500">+1.2% desde ayer</span>
                </div>
              </div>
              <div class="bg-blue-100 dark:bg-blue-900/30 p-3 rounded-full">
                <i class="fas fa-check-circle text-blue-500 text-xl"></i>
              </div>
            </div>
          </div>

          <div
            class="metric-card bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow hover:shadow-lg transition-all duration-300"
          >
            <div class="flex items-center justify-between">
              <div>
                <p
                  class="text-sm font-medium text-gray-600 dark:text-gray-400"
                  data-translate="summary.incidentCount"
                >
                  Número de Incidentes
                </p>
                <p class="text-3xl font-bold text-red-500" id="incidentCount">
                  127
                </p>
                <div class="flex items-center mt-2">
                  <i class="fas fa-arrow-down text-green-500 text-xs mr-1"></i>
                  <span class="text-xs text-green-500">-8 desde ayer</span>
                </div>
              </div>
              <div class="bg-red-100 dark:bg-red-900/30 p-3 rounded-full">
                <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>
              </div>
            </div>
          </div>

          <div
            class="metric-card bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow hover:shadow-lg transition-all duration-300"
          >
            <div class="flex items-center justify-between">
              <div>
                <p
                  class="text-sm font-medium text-gray-600 dark:text-gray-400"
                  data-translate="summary.userSatisfaction"
                >
                  Satisfacción del Usuario
                </p>
                <p
                  class="text-3xl font-bold text-green-500"
                  id="userSatisfaction"
                >
                  4.7/5
                </p>
                <div class="flex items-center mt-2">
                  <i class="fas fa-arrow-up text-green-500 text-xs mr-1"></i>
                  <span class="text-xs text-green-500">+0.1 desde ayer</span>
                </div>
              </div>
              <div class="bg-green-100 dark:bg-green-900/30 p-3 rounded-full">
                <i class="fas fa-star text-green-500 text-xl"></i>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Incidentes -->
      <section id="incidents" class="mb-8">
        <h2
          class="text-2xl font-semibold text-gray-800 dark:text-white mb-6"
          data-translate="section.incidents"
        >
          Análisis de Incidentes
        </h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3
                class="text-lg font-semibold text-gray-700 dark:text-gray-300"
                data-translate="chart.incidentsByType"
              >
                Incidentes por Tipo
              </h3>
              <button class="info-btn" data-info="incidents-type">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
            <canvas id="incidentTypeChart"></canvas>
          </div>

          <div class="bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3
                class="text-lg font-semibold text-gray-700 dark:text-gray-300"
                data-translate="chart.heatmap"
              >
                Mapa de Calor - Ubicaciones
              </h3>
              <button class="info-btn" data-info="heatmap">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
            <div
              id="heatmapPlaceholder"
              class="h-64 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center relative overflow-hidden"
            >
              <div
                class="absolute inset-0 bg-gradient-to-br from-red-500/20 via-yellow-500/20 to-green-500/20"
              ></div>
              <div class="text-center z-10">
                <i
                  class="fas fa-map-marked-alt text-4xl text-gray-400 mb-2"
                ></i>
                <p class="text-gray-500 dark:text-gray-400">
                  Mapa de calor interactivo
                </p>
                <p class="text-sm text-gray-400">Zonas de mayor incidencia</p>
              </div>
              <!-- Simulated heat points -->
              <div
                class="absolute top-1/4 left-1/3 w-4 h-4 bg-red-500 rounded-full opacity-60 animate-pulse"
              ></div>
              <div
                class="absolute top-1/2 right-1/4 w-3 h-3 bg-yellow-500 rounded-full opacity-50 animate-pulse"
              ></div>
              <div
                class="absolute bottom-1/3 left-1/2 w-5 h-5 bg-orange-500 rounded-full opacity-70 animate-pulse"
              ></div>
            </div>
          </div>
        </div>
      </section>

      <!-- Análisis de Tendencias -->
      <section id="trends" class="mb-8">
        <h2
          class="text-2xl font-semibold text-gray-800 dark:text-white mb-6"
          data-translate="section.trends"
        >
          Análisis de Tendencias
        </h2>
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow">
          <div class="flex items-center justify-between mb-4">
            <h3
              class="text-lg font-semibold text-gray-700 dark:text-gray-300"
              data-translate="chart.monthlyTrends"
            >
              Tendencias Mensuales
            </h3>
            <div class="flex items-center space-x-2">
              <button class="info-btn" data-info="trends">
                <i class="fas fa-info-circle"></i>
              </button>
              <select
                id="trendsTimeRange"
                class="text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-1 bg-white dark:bg-gray-700 dark:text-white"
              >
                <option value="12m">Últimos 12 meses</option>
                <option value="6m">Últimos 6 meses</option>
                <option value="3m">Últimos 3 meses</option>
              </select>
            </div>
          </div>
          <canvas id="trendsChart"></canvas>
        </div>
      </section>

      <!-- Análisis de Tiempo -->
      <section id="time" class="mb-8">
        <h2
          class="text-2xl font-semibold text-gray-800 dark:text-white mb-6"
          data-translate="section.time"
        >
          Análisis de Tiempo
        </h2>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3
                class="text-lg font-semibold text-gray-700 dark:text-gray-300"
                data-translate="chart.hourlyIncidents"
              >
                Incidentes por Hora
              </h3>
              <button class="info-btn" data-info="hourly">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
            <canvas id="hourlyChart"></canvas>
          </div>

          <div class="bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3
                class="text-lg font-semibold text-gray-700 dark:text-gray-300"
                data-translate="chart.dailyIncidents"
              >
                Incidentes por Día
              </h3>
              <button class="info-btn" data-info="daily">
                <i class="fas fa-info-circle"></i>
              </button>
            </div>
            <canvas id="dailyChart"></canvas>
          </div>
        </div>
      </section>

      <!-- KPIs -->
      <section id="kpis" class="mb-8">
        <div class="flex items-center justify-between mb-6">
          <h2
            class="text-2xl font-semibold text-gray-800 dark:text-white"
            data-translate="section.kpis"
          >
            Indicadores Clave de Rendimiento (KPIs)
          </h2>
          <button class="info-btn" data-info="kpis">
            <i class="fas fa-info-circle"></i>
          </button>
        </div>
        <div
          class="bg-white dark:bg-gray-800 rounded-lg p-6 card-shadow overflow-x-auto"
        >
          <table class="w-full text-sm text-left">
            <thead
              class="text-xs text-gray-700 dark:text-gray-300 uppercase bg-gray-50 dark:bg-gray-700"
            >
              <tr>
                <th class="px-6 py-3" data-translate="kpi.indicator">
                  Indicador
                </th>
                <th class="px-6 py-3" data-translate="kpi.current">
                  Valor Actual
                </th>
                <th class="px-6 py-3" data-translate="kpi.target">Objetivo</th>
                <th class="px-6 py-3" data-translate="kpi.status">Estado</th>
              </tr>
            </thead>
            <tbody id="kpiTableBody">
              <!-- KPIs will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </section>
    </main>

    <!-- Chatbot -->
    <div id="chatbot" class="fixed bottom-6 right-6 z-50">
      <!-- Chatbot Toggle Button -->
      <button
        id="chatbotToggle"
        class="bg-gradient-to-r from-orange-500 to-blue-600 text-white p-4 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-110"
      >
        <i class="fas fa-comments text-xl"></i>
      </button>

      <!-- Chatbot Window -->
      <div
        id="chatbotWindow"
        class="hidden absolute bottom-16 right-0 w-80 h-96 bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 flex flex-col"
      >
        <!-- Header -->
        <div
          class="bg-gradient-to-r from-orange-500 to-blue-600 text-white p-4 rounded-t-lg flex items-center justify-between"
        >
          <div class="flex items-center space-x-2">
            <i class="fas fa-robot"></i>
            <span class="font-semibold" data-translate="chatbot.title"
              >Asistente Chakipur</span
            >
          </div>
          <button id="chatbotClose" class="hover:bg-white/20 p-1 rounded">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <!-- Messages -->
        <div id="chatbotMessages" class="flex-1 p-4 overflow-y-auto space-y-3">
          <div class="flex items-start space-x-2">
            <div class="bg-orange-100 dark:bg-orange-900/30 p-2 rounded-full">
              <i class="fas fa-robot text-orange-500 text-sm"></i>
            </div>
            <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg max-w-xs">
              <p class="text-sm" data-translate="chatbot.welcome">
                ¡Hola! Soy tu asistente virtual. ¿En qué puedo ayudarte hoy?
              </p>
            </div>
          </div>
        </div>

        <!-- Input -->
        <div class="p-4 border-t border-gray-200 dark:border-gray-700">
          <div class="flex space-x-2">
            <input
              type="text"
              id="chatbotInput"
              class="flex-1 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 dark:bg-gray-700 dark:text-white"
              data-translate="chatbot.placeholder"
              placeholder="Escribe tu pregunta aquí..."
            />
            <button
              id="chatbotSend"
              class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors"
            >
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Insights Modal -->
    <div
      id="insightsModal"
      class="fixed inset-0 bg-black/50 z-50 hidden flex items-center justify-center p-4"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto"
      >
        <div class="p-6">
          <div class="flex items-center justify-between mb-6">
            <h2
              class="text-2xl font-bold text-gray-800 dark:text-white"
              data-translate="insights.title"
            >
              Conclusiones Inteligentes
            </h2>
            <button
              id="closeInsights"
              class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
            >
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>

          <div id="insightsContent" class="space-y-6">
            <!-- Content will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Info Tooltips -->
    <div
      id="infoTooltip"
      class="fixed z-50 bg-gray-800 text-white p-3 rounded-lg shadow-lg max-w-xs hidden"
    >
      <div id="tooltipContent"></div>
    </div>

    <script src="translations.js"></script>
    <script src="auth.js"></script>
    <script src="config.js"></script>
    <script src="chatbot.js"></script>
    <script src="insights.js"></script>
    <script src="dashboard.js"></script>
  </body>
</html>
